{
  "version": 3,
  "sources": ["../src/wgpu/shaders.ts", "../src/wgpu/wrapper.ts", "../src/main.ts"],
  "sourcesContent": ["const shaders = /* wgsl */`\r\nstruct VertexOut {\r\n    @builtin(position) position : vec4f,\r\n    @location(0) colour : vec4f\r\n}\r\n\r\n@vertex\r\nfn vertex_main(@location(0) position : vec4f, @location(1) colour : vec4f) -> VertexOut {\r\n    var output : VertexOut;\r\n    output.position = vec4<f32>(position.x * 0.8, position.y * 0.8, position.z, position.w);\r\n    output.colour = colour;\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fragment_main(fragData: VertexOut) -> @location(0) vec4f {\r\n    return fragData.colour;\r\n}\r\n\r\n`;\r\n\r\n\r\nexport { shaders };", "import { shaders } from \"./shaders.ts\";\r\n\r\nexport class WGPU {\r\n  private device: GPUDevice = {} as GPUDevice;\r\n  private ctx: GPUCanvasContext = {} as GPUCanvasContext;\r\n  private renderPipeline: GPURenderPipeline = {} as GPURenderPipeline; \r\n  private commandEncoder: GPUCommandEncoder = {} as GPUCommandEncoder;\r\n\r\n  \r\n  async init(): Promise<boolean> {\r\n    if (!navigator.gpu) {\r\n      throw Error(\"WebGPU not supported.\");\r\n    }\r\n\r\n    const adapter = await navigator.gpu.requestAdapter();\r\n    if (!adapter) {\r\n      throw Error(\"Couldn't request WebGPU adapter.\");\r\n    }\r\n\r\n\r\n    this.device = await adapter.requestDevice();\r\n\r\n    const shaderModule = this.device.createShaderModule({\r\n      code: shaders\r\n    })\r\n\r\n    const canvas = document.querySelector(\"#gpuCanvas\") as HTMLCanvasElement;\r\n    this.ctx = canvas.getContext(\"webgpu\") as GPUCanvasContext;\r\n\r\n    this.ctx.configure({\r\n      device: this.device,\r\n      format: navigator.gpu.getPreferredCanvasFormat(),\r\n      alphaMode: \"opaque\"\r\n    });\r\n\r\n\r\n    const vertBufferLayouts = [\r\n      {\r\n        attributes: [\r\n          {\r\n            shaderLocation: 0,\r\n            offset: 0,\r\n            format: \"float32x4\"\r\n          },\r\n          {\r\n            shaderLocation: 1,\r\n            offset: 16,\r\n            format: \"float32x4\"\r\n          }\r\n        ],\r\n        arrayStride: 32,\r\n        stepMode: \"vertex\"\r\n      } as GPUVertexBufferLayout\r\n    ];\r\n\r\n    this.renderPipeline = this.device.createRenderPipeline({\r\n      vertex: {\r\n        module: shaderModule,\r\n        entryPoint: \"vertex_main\",\r\n        buffers: vertBufferLayouts\r\n      },\r\n      fragment: {\r\n        module: shaderModule,\r\n        entryPoint: \"fragment_main\",\r\n        targets: [{ format: navigator.gpu.getPreferredCanvasFormat() }]\r\n      },\r\n      primitive: {\r\n        topology: \"triangle-list\"\r\n      },\r\n      layout: \"auto\"\r\n    });\r\n\r\n    this.commandEncoder = this.device.createCommandEncoder();\r\n\r\n    return true;\r\n  }\r\n\r\n\r\n  render() {\r\n    const verts = new Float32Array([\r\n      0.0, 0.6, 0, 1, \r\n      1, 0, 0, 1, \r\n      \r\n      -0.5, -0.6, 0, 1, \r\n      0, 1, 0, 1, 1, \r\n      \r\n      -0.6, 0, 1, \r\n      0, 0, 1, 1,\r\n    ]);\r\n\r\n    const vertexBuffer = this.device.createBuffer({\r\n      size: verts.byteLength,\r\n      usage: GPUBufferUsage.VERTEX | GPUBufferUsage.COPY_DST\r\n    });\r\n\r\n    this.device.queue.writeBuffer(vertexBuffer, 0, verts, 0, verts.length);\r\n\r\n\r\n\r\n    const passEncoder = this.commandEncoder.beginRenderPass({\r\n      colorAttachments: [\r\n      {\r\n        clearValue: { r: 0.1, g: 0.1, b: 0.1, a: 1 },\r\n        loadOp: \"clear\",\r\n        storeOp: \"store\",\r\n        view: this.ctx.getCurrentTexture().createView()\r\n      }\r\n      ]\r\n    });\r\n\r\n    passEncoder.setPipeline(this.renderPipeline);\r\n    passEncoder.setVertexBuffer(0, vertexBuffer);\r\n    passEncoder.draw(3);\r\n\r\n    passEncoder.end();\r\n    this.device.queue.submit([this.commandEncoder.finish()]);\r\n  }\r\n}", "import {WGPU} from \"./wgpu/wrapper.ts\"\r\n\r\nasync function main() {\r\n  const wgpu = new WGPU();\r\n\r\n  const success = await wgpu.init()\r\n  if (!success) \r\n    return;\r\n    \r\n\r\n  window.wgpu = wgpu;\r\n\r\n  wgpu.render()\r\n\r\n}\r\n\r\nmain()"],
  "mappings": "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",
  "names": []
}
